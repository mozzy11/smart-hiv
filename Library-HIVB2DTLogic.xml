<?xml version="1.0" encoding="UTF-8"?>

<Library xmlns="http://hl7.org/fhir">
  <id value="HIVB2DTLogic"/>
  <meta>
    <profile value="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-shareablelibrary"/>
    <profile value="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-publishablelibrary"/>
    <profile value="http://hl7.org/fhir/uv/cql/StructureDefinition/cql-library"/>
    <profile value="http://hl7.org/fhir/uv/cql/StructureDefinition/cql-module"/>
  </meta>
  <text>
    <status value="generated"/><div xmlns="http://www.w3.org/1999/xhtml"><p class="res-header-id"><b>Generated Narrative: Library HIVB2DTLogic</b></p><a name="HIVB2DTLogic"> </a><a name="hcHIVB2DTLogic"> </a><a name="HIVB2DTLogic-en-US"> </a><h2>Contents</h2><p><code>text/cql</code></p><pre><code class="language-sql">/**
Library: HIV.B2.DT Logic

@DecisionID: HIV.B2.DT
@BusinessRule:
@Trigger: 
@Description: 

Check for signs of serious illness
Consolidated guidelines on HIV prevention, testing, treatment, service delivery and monitoring: recommendations for a public health approach (2021) Chapter 5: Advanced HIV Disease. Figure 5.1: Algorithm for providing a package of care for people with advanced HIV disease.  
Should this just be for anyone with HIV? 
Wouldn't other  disease domains also code for general exam?
*/

library HIVB2DTLogic

 using FHIR version '4.0.1'
 

 include HIVCommon version '0.0.1' called HIC
 include FHIRHelpers version '4.0.1'
 include WHOCommon called WCom
 include FHIRCommon called FC

 valueset &quot;Tachycardia&quot;: ''
 valueset &quot;Tachypnea&quot;: ''
 valueset &quot;Unable to walk unaided&quot;: ''
 valueset &quot;Body temperature = ≥ 39 °C&quot;: '' 
 valueset &quot;Other sign of serious illness (specify)&quot;: ''
 valueset &quot;Lethargy&quot;: ''
 valueset &quot;Unconsciousness&quot;: ''
 valueset &quot;Convulsions&quot;: ''
 valueset &quot;Unable to breastfeed&quot;: ''
 valueset &quot;Unable to drink&quot;: ''
 valueset &quot;Repeated vomiting&quot;: ''

 context Patient

 /*
  * Age = ≥ 10 years
  */

define &quot;Age_10_or_more&quot;:
  AgeInYearsAt(Today()) &gt;= 10

 /*
  * Age &lt; 10 years
  */

define &quot;Age_less_than_10&quot;:
  AgeInYearsAt(Today()) &lt; 10

define &quot;Take action or refer client showing signs of a serious illness&quot;:
  exists(([Observation: &quot;Tachycardia&quot;]
  union [Observation: &quot;Tachypnea&quot;]
  union [Observation: &quot;Unable to walk unaided&quot;]) O
  where Age_10_or_more
  and O.status in { 'final', 'amended' })
  or exists(([Observation: &quot;Lethargy&quot;]
  union [Observation: &quot;Unconsciousness&quot;]
  union [Observation: &quot;Convulsions&quot;]
  union [Observation: &quot;Unable to breastfeed&quot;]
  union [Observation: &quot;Unable to drink&quot;]
  union [Observation: &quot;Unconsciousness&quot;]
  union [Observation: &quot;Repeated vomiting&quot;]) O
  where Age_less_than_10
  and O.status in { 'final', 'amended' }
  )

//plan definition Immediately take action or refer for care if a client is having this issue.

define &quot;Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill&quot;:
  exists (([Observation: &quot;Body temperature = ≥ 39 °C&quot;]
  union [Observation: &quot;Other sign of serious illness (specify)&quot;]) O
  where Age_10_or_more
  and O.status in { 'final', 'amended' })
  // Please this condition needs to be fixed
  // or exists((([Observation: &quot;Body temperature = ≥ 39 °C&quot;]
  // intersect [Observation: &quot;Tachycardia&quot;])
  // or ([Observation: &quot;Body temperature = ≥ 39 °C&quot;]
  // intersect [Observation: &quot;Tachypnea&quot;])
  // or [Observation: &quot;Other sign of serious illness (specify)&quot;]) O
  // where Age_less_than_10
  // and O.status in { 'final', 'amended' })
  // )


//plan definition  Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill. 
</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>
  </text>
  <extension url="http://hl7.org/fhir/StructureDefinition/cqf-knowledgeCapability">
    <valueCode value="computable"/>
  </extension>
  <url value="http://smart.who.int/HIV/Library/HIVB2DTLogic"/>
  <version value="0.2.0"/>
  <name value="HIVB2DTLogic"/>
  <title value="HIV.B2.DT Logic"/>
  <status value="draft"/>
  <experimental value="true"/>
  <type>
    <coding>
      <system value="http://terminology.hl7.org/CodeSystem/library-type"/>
      <code value="logic-library"/>
    </coding>
  </type>
  <date value="2024-08-05T14:13:53+00:00"/>
  <publisher value="WHO"/>
  <contact>
    <name value="WHO"/>
    <telecom>
      <system value="url"/>
      <value value="http://who.int"/>
    </telecom>
  </contact>
  <description value="Description not yet available for HIV.B2.DT Logic."/>
  <content>
    <contentType value="text/cql"/>
    <data value="LyoqCkxpYnJhcnk6IEhJVi5CMi5EVCBMb2dpYwoKQERlY2lzaW9uSUQ6IEhJVi5CMi5EVApAQnVzaW5lc3NSdWxlOgpAVHJpZ2dlcjogCkBEZXNjcmlwdGlvbjogCgpDaGVjayBmb3Igc2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzCkNvbnNvbGlkYXRlZCBndWlkZWxpbmVzIG9uIEhJViBwcmV2ZW50aW9uLCB0ZXN0aW5nLCB0cmVhdG1lbnQsIHNlcnZpY2UgZGVsaXZlcnkgYW5kIG1vbml0b3Jpbmc6IHJlY29tbWVuZGF0aW9ucyBmb3IgYSBwdWJsaWMgaGVhbHRoIGFwcHJvYWNoICgyMDIxKSBDaGFwdGVyIDU6IEFkdmFuY2VkIEhJViBEaXNlYXNlLiBGaWd1cmUgNS4xOiBBbGdvcml0aG0gZm9yIHByb3ZpZGluZyBhIHBhY2thZ2Ugb2YgY2FyZSBmb3IgcGVvcGxlIHdpdGggYWR2YW5jZWQgSElWIGRpc2Vhc2UuICAKU2hvdWxkIHRoaXMganVzdCBiZSBmb3IgYW55b25lIHdpdGggSElWPyAKV291bGRuJ3Qgb3RoZXIgIGRpc2Vhc2UgZG9tYWlucyBhbHNvIGNvZGUgZm9yIGdlbmVyYWwgZXhhbT8KKi8KCmxpYnJhcnkgSElWQjJEVExvZ2ljCgogdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScKIAoKIGluY2x1ZGUgSElWQ29tbW9uIHZlcnNpb24gJzAuMC4xJyBjYWxsZWQgSElDCiBpbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJwogaW5jbHVkZSBXSE9Db21tb24gY2FsbGVkIFdDb20KIGluY2x1ZGUgRkhJUkNvbW1vbiBjYWxsZWQgRkMKCiB2YWx1ZXNldCAiVGFjaHljYXJkaWEiOiAnJwogdmFsdWVzZXQgIlRhY2h5cG5lYSI6ICcnCiB2YWx1ZXNldCAiVW5hYmxlIHRvIHdhbGsgdW5haWRlZCI6ICcnCiB2YWx1ZXNldCAiQm9keSB0ZW1wZXJhdHVyZSA9IOKJpSAzOSDCsEMiOiAnJyAKIHZhbHVlc2V0ICJPdGhlciBzaWduIG9mIHNlcmlvdXMgaWxsbmVzcyAoc3BlY2lmeSkiOiAnJwogdmFsdWVzZXQgIkxldGhhcmd5IjogJycKIHZhbHVlc2V0ICJVbmNvbnNjaW91c25lc3MiOiAnJwogdmFsdWVzZXQgIkNvbnZ1bHNpb25zIjogJycKIHZhbHVlc2V0ICJVbmFibGUgdG8gYnJlYXN0ZmVlZCI6ICcnCiB2YWx1ZXNldCAiVW5hYmxlIHRvIGRyaW5rIjogJycKIHZhbHVlc2V0ICJSZXBlYXRlZCB2b21pdGluZyI6ICcnCgogY29udGV4dCBQYXRpZW50CgogLyoKICAqIEFnZSA9IOKJpSAxMCB5ZWFycwogICovCgpkZWZpbmUgIkFnZV8xMF9vcl9tb3JlIjoKICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPj0gMTAKCiAvKgogICogQWdlIDwgMTAgeWVhcnMKICAqLwoKZGVmaW5lICJBZ2VfbGVzc190aGFuXzEwIjoKICBBZ2VJblllYXJzQXQoVG9kYXkoKSkgPCAxMAoKZGVmaW5lICJUYWtlIGFjdGlvbiBvciByZWZlciBjbGllbnQgc2hvd2luZyBzaWducyBvZiBhIHNlcmlvdXMgaWxsbmVzcyI6CiAgZXhpc3RzKChbT2JzZXJ2YXRpb246ICJUYWNoeWNhcmRpYSJdCiAgdW5pb24gW09ic2VydmF0aW9uOiAiVGFjaHlwbmVhIl0KICB1bmlvbiBbT2JzZXJ2YXRpb246ICJVbmFibGUgdG8gd2FsayB1bmFpZGVkIl0pIE8KICB3aGVyZSBBZ2VfMTBfb3JfbW9yZQogIGFuZCBPLnN0YXR1cyBpbiB7ICdmaW5hbCcsICdhbWVuZGVkJyB9KQogIG9yIGV4aXN0cygoW09ic2VydmF0aW9uOiAiTGV0aGFyZ3kiXQogIHVuaW9uIFtPYnNlcnZhdGlvbjogIlVuY29uc2Npb3VzbmVzcyJdCiAgdW5pb24gW09ic2VydmF0aW9uOiAiQ29udnVsc2lvbnMiXQogIHVuaW9uIFtPYnNlcnZhdGlvbjogIlVuYWJsZSB0byBicmVhc3RmZWVkIl0KICB1bmlvbiBbT2JzZXJ2YXRpb246ICJVbmFibGUgdG8gZHJpbmsiXQogIHVuaW9uIFtPYnNlcnZhdGlvbjogIlVuY29uc2Npb3VzbmVzcyJdCiAgdW5pb24gW09ic2VydmF0aW9uOiAiUmVwZWF0ZWQgdm9taXRpbmciXSkgTwogIHdoZXJlIEFnZV9sZXNzX3RoYW5fMTAKICBhbmQgTy5zdGF0dXMgaW4geyAnZmluYWwnLCAnYW1lbmRlZCcgfQogICkKCi8vcGxhbiBkZWZpbml0aW9uIEltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGEgY2xpZW50IGlzIGhhdmluZyB0aGlzIGlzc3VlLgoKZGVmaW5lICJVc2UgY2xpbmljYWwganVkZ2VtZW50IGFuZCBjb25zaWRlciBsb2NhbCBlcGlkZW1pb2xvZ3kgdG8gZGV0ZXJtaW5lIGlmIHN5bXB0b21zIHN1Z2dlc3QgY2xpZW50IGlzIHNlcmlvdXNseSBpbGwiOgogIGV4aXN0cyAoKFtPYnNlcnZhdGlvbjogIkJvZHkgdGVtcGVyYXR1cmUgPSDiiaUgMzkgwrBDIl0KICB1bmlvbiBbT2JzZXJ2YXRpb246ICJPdGhlciBzaWduIG9mIHNlcmlvdXMgaWxsbmVzcyAoc3BlY2lmeSkiXSkgTwogIHdoZXJlIEFnZV8xMF9vcl9tb3JlCiAgYW5kIE8uc3RhdHVzIGluIHsgJ2ZpbmFsJywgJ2FtZW5kZWQnIH0pCiAgLy8gUGxlYXNlIHRoaXMgY29uZGl0aW9uIG5lZWRzIHRvIGJlIGZpeGVkCiAgLy8gb3IgZXhpc3RzKCgoW09ic2VydmF0aW9uOiAiQm9keSB0ZW1wZXJhdHVyZSA9IOKJpSAzOSDCsEMiXQogIC8vIGludGVyc2VjdCBbT2JzZXJ2YXRpb246ICJUYWNoeWNhcmRpYSJdKQogIC8vIG9yIChbT2JzZXJ2YXRpb246ICJCb2R5IHRlbXBlcmF0dXJlID0g4omlIDM5IMKwQyJdCiAgLy8gaW50ZXJzZWN0IFtPYnNlcnZhdGlvbjogIlRhY2h5cG5lYSJdKQogIC8vIG9yIFtPYnNlcnZhdGlvbjogIk90aGVyIHNpZ24gb2Ygc2VyaW91cyBpbGxuZXNzIChzcGVjaWZ5KSJdKSBPCiAgLy8gd2hlcmUgQWdlX2xlc3NfdGhhbl8xMAogIC8vIGFuZCBPLnN0YXR1cyBpbiB7ICdmaW5hbCcsICdhbWVuZGVkJyB9KQogIC8vICkKCgovL3BsYW4gZGVmaW5pdGlvbiAgVXNlIGNsaW5pY2FsIGp1ZGdlbWVudCBhbmQgY29uc2lkZXIgbG9jYWwgZXBpZGVtaW9sb2d5IHRvIGRldGVybWluZSBpZiBzeW1wdG9tcyBzdWdnZXN0IGNsaWVudCBpcyBzZXJpb3VzbHkgaWxsLiAK"/>
  </content>
  <content>
    <contentType value="application/elm+xml"/>
  </content>
</Library>