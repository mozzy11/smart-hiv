{
  "resourceType" : "Library",
  "id" : "HIVB2DTLogic",
  "meta" : {
    "profile" : ["http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-shareablelibrary",
    "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-publishablelibrary",
    "http://hl7.org/fhir/uv/cql/StructureDefinition/cql-library",
    "http://hl7.org/fhir/uv/cql/StructureDefinition/cql-module"]
  },
  "text" : {
    "status" : "generated",
    "div" : "<div xmlns=\"http://www.w3.org/1999/xhtml\"><p class=\"res-header-id\"><b>Generated Narrative: Library HIVB2DTLogic</b></p><a name=\"HIVB2DTLogic\"> </a><a name=\"hcHIVB2DTLogic\"> </a><a name=\"HIVB2DTLogic-en-US\"> </a><h2>Contents</h2><p><code>text/cql</code></p><pre><code class=\"language-sql\">/**\nLibrary: HIV.B2.DT Logic\n\n@DecisionID: HIV.B2.DT\n@BusinessRule: Check for signs of serious illness\n@Trigger: HIV.B2 Check for signs of serious illness\n@Trigger: HIV.D3 Check for signs of serious illness\n@HitPolicy: Rule Order\n@Description: Check for serious illness\n\nData Concepts:\n * HIV.A.DE17: Age | Calculated age (number of years) of the client based on date of birth\n * HIV.D.DE17: Signs of serious illness | Signs that may indicate the client has a serious illness and needs triage or an emergency referral\n * HIV.D.DE9: Body temperature | Temperature of the client in Celsius\n\nConsolidated guidelines on HIV prevention, testing, treatment, service delivery and monitoring: recommendations for a public health approach (2021) Chapter 5: Advanced HIV Disease. Figure 5.1: Algorithm for providing a package of care for people with advanced HIV disease.\n*/\n\nlibrary HIVB2DTLogic\n\nusing FHIR version '4.0.1'\n\ninclude HIVCommon version '0.0.1' called HIC\ninclude HIVConcepts called HCx\ninclude HIVEncounterElements called Elements\ninclude FHIRHelpers version '4.0.1'\ninclude FHIRCommon called FC\ninclude WHOCommon called WCom\n\ncontext Patient\n\n /*\n  @input: &quot;Age 10 or older&quot;\n  @pseudocode: 'Age' &gt;= 10 years\n  */\ndefine &quot;Age 10 or older&quot;:\n  AgeInYearsAt(Today()) &gt;= 10\n\n /*\n  @input: &quot;Age under 10&quot;\n  @pseudocode: 'Age' &lt; 10 years\n  */\ndefine &quot;Age under 10&quot;:\n  AgeInYearsAt(Today()) &lt; 10\n\n/*\n @output: &quot;Immediately take action or refer for care if a client is having this issue&quot;\n */\ndefine &quot;Immediately take action or refer for care if a client is having this issue&quot;:\n  exists(Elements.&quot;Signs of serious illness&quot; O\n    where &quot;Age 10 or older&quot; \n      and O.value ~ HCx.&quot;Tachycardia&quot;)\n\n/*\n @output &quot;Immediately take action or refer for care if client is showing this sign of a serious illness.&quot;\n */\ndefine &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot;:\n  &quot;Signs of serious illness age 10 or older&quot; or &quot;Signs of serious illness age under 10&quot;\n\n/*\n @output &quot;Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill&quot;\n */\ndefine &quot;Use clinical judgement and consider local epidemiology to determine if symptoms suggest client is seriously ill&quot;:\n  &quot;Signs of serious illness requiring clinical judgement age 10 or older&quot; or &quot;Signs of serious illness requiring clinical judgement age under 10&quot;\n\n/*\n @dynamicValue: Guidance\n */\ndefine &quot;Guidance&quot;:\n  case \n  when &quot;Immediately take action or refer for care if a client is having this issue&quot; \n    then &quot;Immediately take action or refer for care if a client is having this issue.&quot;\n  when &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot; and &quot;Age 10 or older&quot;\n    then &quot;Immediately take action or refer for care if client is showing this sign of a serious illness.&quot;\n  when &quot;Immediately take action or refer for care if client is showing this sign of a serious illness&quot; and &quot;Age under 10&quot;\n    then &quot;&quot;&quot;This is a sign and/or symptom of a serious health condition.\n  \nImmediately take action or refer for care if client is showing this sign of a serious illness.&quot;&quot;&quot;\n  else null\n  end\n\n/*\n Supporting Logic\n*/\ndefine &quot;Signs of serious illness age 10 or older&quot;:\n  &quot;Age 10 or older&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where\n      O.value ~ HCx.&quot;Tachypnea&quot; or\n      O.value ~ HCx.&quot;Unable to walk unaided&quot;\n\ndefine &quot;Signs of serious illness age under 10&quot;:\n  &quot;Age under 10&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where \n      O.value in {\n        HCx.&quot;Lethargy - HIV.D.DE22&quot;,\n        HCx.&quot;Unconsciousness&quot;,\n        HCx.&quot;Convulsions&quot;,\n        HCx.&quot;Unable to breastfeed&quot;,\n        HCx.&quot;Unable to drink&quot;,\n        HCx.&quot;Repeated vomiting&quot;\n      } \n  \ndefine &quot;Signs of serious illness requiring clinical judgement age 10 or older&quot;:\n  &quot;Age 10 or older&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where\n      O.value ~ HCx.&quot;Fever of 39 C or greater&quot; or\n      O.value ~ HCx.&quot;Other sign of serious illness&quot;\n  \ndefine &quot;Signs of serious illness requiring clinical judgement age under 10&quot;:\n  &quot;Age under 10&quot; and Elements.&quot;Signs of serious illness&quot; O\n    where \n      O.value ~ HCx.&quot;Fever of 39 C or greater&quot; or\n      O.value ~ HCx.&quot;Other sign of serious illness&quot;\n</code></pre><p><code>No Content</code> (<code>application/elm+xml</code>)</p></div>"
  },
  "extension" : [{
    "url" : "http://hl7.org/fhir/StructureDefinition/cqf-knowledgeCapability",
    "valueCode" : "computable"
  }],
  "url" : "http://smart.who.int/HIV/Library/HIVB2DTLogic",
  "version" : "0.2.0",
  "name" : "HIVB2DTLogic",
  "title" : "HIV.B2.DT Logic",
  "status" : "draft",
  "experimental" : true,
  "type" : {
    "coding" : [{
      "system" : "http://terminology.hl7.org/CodeSystem/library-type",
      "code" : "logic-library"
    }]
  },
  "date" : "2024-08-06T17:04:54+00:00",
  "publisher" : "WHO",
  "contact" : [{
    "name" : "WHO",
    "telecom" : [{
      "system" : "url",
      "value" : "http://who.int"
    }]
  }],
  "description" : "Description not yet available for HIV.B2.DT Logic.",
  "content" : [{
    "contentType" : "text/cql",
    "data" : "LyoqCkxpYnJhcnk6IEhJVi5CMi5EVCBMb2dpYwoKQERlY2lzaW9uSUQ6IEhJVi5CMi5EVApAQnVzaW5lc3NSdWxlOiBDaGVjayBmb3Igc2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzCkBUcmlnZ2VyOiBISVYuQjIgQ2hlY2sgZm9yIHNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcwpAVHJpZ2dlcjogSElWLkQzIENoZWNrIGZvciBzaWducyBvZiBzZXJpb3VzIGlsbG5lc3MKQEhpdFBvbGljeTogUnVsZSBPcmRlcgpARGVzY3JpcHRpb246IENoZWNrIGZvciBzZXJpb3VzIGlsbG5lc3MKCkRhdGEgQ29uY2VwdHM6CiAqIEhJVi5BLkRFMTc6IEFnZSB8IENhbGN1bGF0ZWQgYWdlIChudW1iZXIgb2YgeWVhcnMpIG9mIHRoZSBjbGllbnQgYmFzZWQgb24gZGF0ZSBvZiBiaXJ0aAogKiBISVYuRC5ERTE3OiBTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgfCBTaWducyB0aGF0IG1heSBpbmRpY2F0ZSB0aGUgY2xpZW50IGhhcyBhIHNlcmlvdXMgaWxsbmVzcyBhbmQgbmVlZHMgdHJpYWdlIG9yIGFuIGVtZXJnZW5jeSByZWZlcnJhbAogKiBISVYuRC5ERTk6IEJvZHkgdGVtcGVyYXR1cmUgfCBUZW1wZXJhdHVyZSBvZiB0aGUgY2xpZW50IGluIENlbHNpdXMKCkNvbnNvbGlkYXRlZCBndWlkZWxpbmVzIG9uIEhJViBwcmV2ZW50aW9uLCB0ZXN0aW5nLCB0cmVhdG1lbnQsIHNlcnZpY2UgZGVsaXZlcnkgYW5kIG1vbml0b3Jpbmc6IHJlY29tbWVuZGF0aW9ucyBmb3IgYSBwdWJsaWMgaGVhbHRoIGFwcHJvYWNoICgyMDIxKSBDaGFwdGVyIDU6IEFkdmFuY2VkIEhJViBEaXNlYXNlLiBGaWd1cmUgNS4xOiBBbGdvcml0aG0gZm9yIHByb3ZpZGluZyBhIHBhY2thZ2Ugb2YgY2FyZSBmb3IgcGVvcGxlIHdpdGggYWR2YW5jZWQgSElWIGRpc2Vhc2UuCiovCgpsaWJyYXJ5IEhJVkIyRFRMb2dpYwoKdXNpbmcgRkhJUiB2ZXJzaW9uICc0LjAuMScKCmluY2x1ZGUgSElWQ29tbW9uIHZlcnNpb24gJzAuMC4xJyBjYWxsZWQgSElDCmluY2x1ZGUgSElWQ29uY2VwdHMgY2FsbGVkIEhDeAppbmNsdWRlIEhJVkVuY291bnRlckVsZW1lbnRzIGNhbGxlZCBFbGVtZW50cwppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJwppbmNsdWRlIEZISVJDb21tb24gY2FsbGVkIEZDCmluY2x1ZGUgV0hPQ29tbW9uIGNhbGxlZCBXQ29tCgpjb250ZXh0IFBhdGllbnQKCiAvKgogIEBpbnB1dDogIkFnZSAxMCBvciBvbGRlciIKICBAcHNldWRvY29kZTogJ0FnZScgPj0gMTAgeWVhcnMKICAqLwpkZWZpbmUgIkFnZSAxMCBvciBvbGRlciI6CiAgQWdlSW5ZZWFyc0F0KFRvZGF5KCkpID49IDEwCgogLyoKICBAaW5wdXQ6ICJBZ2UgdW5kZXIgMTAiCiAgQHBzZXVkb2NvZGU6ICdBZ2UnIDwgMTAgeWVhcnMKICAqLwpkZWZpbmUgIkFnZSB1bmRlciAxMCI6CiAgQWdlSW5ZZWFyc0F0KFRvZGF5KCkpIDwgMTAKCi8qCiBAb3V0cHV0OiAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgYSBjbGllbnQgaXMgaGF2aW5nIHRoaXMgaXNzdWUiCiAqLwpkZWZpbmUgIkltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGEgY2xpZW50IGlzIGhhdmluZyB0aGlzIGlzc3VlIjoKICBleGlzdHMoRWxlbWVudHMuIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyIgTwogICAgd2hlcmUgIkFnZSAxMCBvciBvbGRlciIgCiAgICAgIGFuZCBPLnZhbHVlIH4gSEN4LiJUYWNoeWNhcmRpYSIpCgovKgogQG91dHB1dCAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgY2xpZW50IGlzIHNob3dpbmcgdGhpcyBzaWduIG9mIGEgc2VyaW91cyBpbGxuZXNzLiIKICovCmRlZmluZSAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgY2xpZW50IGlzIHNob3dpbmcgdGhpcyBzaWduIG9mIGEgc2VyaW91cyBpbGxuZXNzIjoKICAiU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIGFnZSAxMCBvciBvbGRlciIgb3IgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyBhZ2UgdW5kZXIgMTAiCgovKgogQG91dHB1dCAiVXNlIGNsaW5pY2FsIGp1ZGdlbWVudCBhbmQgY29uc2lkZXIgbG9jYWwgZXBpZGVtaW9sb2d5IHRvIGRldGVybWluZSBpZiBzeW1wdG9tcyBzdWdnZXN0IGNsaWVudCBpcyBzZXJpb3VzbHkgaWxsIgogKi8KZGVmaW5lICJVc2UgY2xpbmljYWwganVkZ2VtZW50IGFuZCBjb25zaWRlciBsb2NhbCBlcGlkZW1pb2xvZ3kgdG8gZGV0ZXJtaW5lIGlmIHN5bXB0b21zIHN1Z2dlc3QgY2xpZW50IGlzIHNlcmlvdXNseSBpbGwiOgogICJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgcmVxdWlyaW5nIGNsaW5pY2FsIGp1ZGdlbWVudCBhZ2UgMTAgb3Igb2xkZXIiIG9yICJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgcmVxdWlyaW5nIGNsaW5pY2FsIGp1ZGdlbWVudCBhZ2UgdW5kZXIgMTAiCgovKgogQGR5bmFtaWNWYWx1ZTogR3VpZGFuY2UKICovCmRlZmluZSAiR3VpZGFuY2UiOgogIGNhc2UgCiAgd2hlbiAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgYSBjbGllbnQgaXMgaGF2aW5nIHRoaXMgaXNzdWUiIAogICAgdGhlbiAiSW1tZWRpYXRlbHkgdGFrZSBhY3Rpb24gb3IgcmVmZXIgZm9yIGNhcmUgaWYgYSBjbGllbnQgaXMgaGF2aW5nIHRoaXMgaXNzdWUuIgogIHdoZW4gIkltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGNsaWVudCBpcyBzaG93aW5nIHRoaXMgc2lnbiBvZiBhIHNlcmlvdXMgaWxsbmVzcyIgYW5kICJBZ2UgMTAgb3Igb2xkZXIiCiAgICB0aGVuICJJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBjbGllbnQgaXMgc2hvd2luZyB0aGlzIHNpZ24gb2YgYSBzZXJpb3VzIGlsbG5lc3MuIgogIHdoZW4gIkltbWVkaWF0ZWx5IHRha2UgYWN0aW9uIG9yIHJlZmVyIGZvciBjYXJlIGlmIGNsaWVudCBpcyBzaG93aW5nIHRoaXMgc2lnbiBvZiBhIHNlcmlvdXMgaWxsbmVzcyIgYW5kICJBZ2UgdW5kZXIgMTAiCiAgICB0aGVuICIiIlRoaXMgaXMgYSBzaWduIGFuZC9vciBzeW1wdG9tIG9mIGEgc2VyaW91cyBoZWFsdGggY29uZGl0aW9uLgogIApJbW1lZGlhdGVseSB0YWtlIGFjdGlvbiBvciByZWZlciBmb3IgY2FyZSBpZiBjbGllbnQgaXMgc2hvd2luZyB0aGlzIHNpZ24gb2YgYSBzZXJpb3VzIGlsbG5lc3MuIiIiCiAgZWxzZSBudWxsCiAgZW5kCgovKgogU3VwcG9ydGluZyBMb2dpYwoqLwpkZWZpbmUgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyBhZ2UgMTAgb3Igb2xkZXIiOgogICJBZ2UgMTAgb3Igb2xkZXIiIGFuZCBFbGVtZW50cy4iU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIiBPCiAgICB3aGVyZQogICAgICBPLnZhbHVlIH4gSEN4LiJUYWNoeXBuZWEiIG9yCiAgICAgIE8udmFsdWUgfiBIQ3guIlVuYWJsZSB0byB3YWxrIHVuYWlkZWQiCgpkZWZpbmUgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyBhZ2UgdW5kZXIgMTAiOgogICJBZ2UgdW5kZXIgMTAiIGFuZCBFbGVtZW50cy4iU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIiBPCiAgICB3aGVyZSAKICAgICAgTy52YWx1ZSBpbiB7CiAgICAgICAgSEN4LiJMZXRoYXJneSAtIEhJVi5ELkRFMjIiLAogICAgICAgIEhDeC4iVW5jb25zY2lvdXNuZXNzIiwKICAgICAgICBIQ3guIkNvbnZ1bHNpb25zIiwKICAgICAgICBIQ3guIlVuYWJsZSB0byBicmVhc3RmZWVkIiwKICAgICAgICBIQ3guIlVuYWJsZSB0byBkcmluayIsCiAgICAgICAgSEN4LiJSZXBlYXRlZCB2b21pdGluZyIKICAgICAgfSAKICAKZGVmaW5lICJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MgcmVxdWlyaW5nIGNsaW5pY2FsIGp1ZGdlbWVudCBhZ2UgMTAgb3Igb2xkZXIiOgogICJBZ2UgMTAgb3Igb2xkZXIiIGFuZCBFbGVtZW50cy4iU2lnbnMgb2Ygc2VyaW91cyBpbGxuZXNzIiBPCiAgICB3aGVyZQogICAgICBPLnZhbHVlIH4gSEN4LiJGZXZlciBvZiAzOSBDIG9yIGdyZWF0ZXIiIG9yCiAgICAgIE8udmFsdWUgfiBIQ3guIk90aGVyIHNpZ24gb2Ygc2VyaW91cyBpbGxuZXNzIgogIApkZWZpbmUgIlNpZ25zIG9mIHNlcmlvdXMgaWxsbmVzcyByZXF1aXJpbmcgY2xpbmljYWwganVkZ2VtZW50IGFnZSB1bmRlciAxMCI6CiAgIkFnZSB1bmRlciAxMCIgYW5kIEVsZW1lbnRzLiJTaWducyBvZiBzZXJpb3VzIGlsbG5lc3MiIE8KICAgIHdoZXJlIAogICAgICBPLnZhbHVlIH4gSEN4LiJGZXZlciBvZiAzOSBDIG9yIGdyZWF0ZXIiIG9yCiAgICAgIE8udmFsdWUgfiBIQ3guIk90aGVyIHNpZ24gb2Ygc2VyaW91cyBpbGxuZXNzIgo="
  },
  {
    "contentType" : "application/elm+xml"
  }]
}